<Window x:Class="EphemeralBrowser.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:EphemeralBrowser.App.Views"
        Title="EphemeralBrowser - Privacy First" 
        Height="900" Width="1200"
        MinHeight="600" MinWidth="800"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        
        <Style x:Key="TabItemStyle" TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="TabBorder" 
                                BorderThickness="1,1,1,0" 
                                BorderBrush="#FFACACAC" 
                                CornerRadius="4,4,0,0" 
                                Margin="2,0"
                                Background="#FFE0E0E0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <ContentPresenter Grid.Column="0"
                                                Name="ContentSite"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Left"
                                                ContentSource="Header"
                                                Margin="12,6,6,6"/>
                                
                                <!-- Privacy Grade Indicator -->
                                <Ellipse Grid.Column="1" 
                                        Width="8" Height="8" 
                                        Margin="6,0"
                                        Fill="LimeGreen"
                                        ToolTip="Privacy Protected"/>
                                
                                <!-- Close Button -->
                                <Button Grid.Column="2" 
                                       Name="CloseButton"
                                       Width="20" Height="20" 
                                       Margin="6,0,12,0"
                                       Content="×"
                                       FontSize="14"
                                       FontWeight="Bold"
                                       Background="Transparent"
                                       BorderThickness="0"
                                       Visibility="{Binding IsSelected, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibility}}"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="TabBorder" Property="Background" Value="White"/>
                                <Setter TargetName="TabBorder" Property="BorderBrush" Value="#FF0078D4"/>
                            </Trigger>
                            <Trigger SourceName="CloseButton" Property="IsMouseOver" Value="True">
                                <Setter TargetName="CloseButton" Property="Background" Value="#FFFF4444"/>
                                <Setter TargetName="CloseButton" Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Address Bar -->
            <RowDefinition Height="Auto"/> <!-- Tab Bar -->
            <RowDefinition Height="*"/>    <!-- Content -->
            <RowDefinition Height="Auto"/> <!-- Status Bar -->
        </Grid.RowDefinitions>
        
        <!-- Address Bar -->
        <Border Grid.Row="0" Background="#FFF0F0F0" BorderBrush="#FFACACAC" BorderThickness="0,0,0,1" Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,8,0">
                    <Button Content="←" Width="32" Height="32" Margin="2" ToolTip="Back" Style="{StaticResource ModernButtonStyle}"/>
                    <Button Content="→" Width="32" Height="32" Margin="2" ToolTip="Forward" Style="{StaticResource ModernButtonStyle}"/>
                    <Button Content="⟳" Width="32" Height="32" Margin="2" ToolTip="Refresh" Style="{StaticResource ModernButtonStyle}"/>
                </StackPanel>
                
                <TextBox Grid.Column="1" 
                         Name="AddressBar"
                         Text="{Binding CurrentUrl, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource ModernTextBoxStyle}"
                         Margin="0,0,8,0"/>
                
                <Button Grid.Column="2" 
                        Content="Go" 
                        Style="{StaticResource ModernButtonStyle}"
                        Margin="0,0,8,0"
                        Command="{Binding NavigateCommand}"
                        CommandParameter="{Binding Text, ElementName=AddressBar}"/>
                
                <Button Grid.Column="3" 
                        Content="+ New Container" 
                        Style="{StaticResource ModernButtonStyle}"
                        Command="{Binding NewTabCommand}"/>
            </Grid>
        </Border>
        
        <!-- Tab Bar -->
        <Border Grid.Row="1" Background="#FFF8F8F8" BorderBrush="#FFACACAC" BorderThickness="0,0,0,1">
            <TabControl Name="TabContainer" 
                       ItemsSource="{Binding Tabs}" 
                       SelectedItem="{Binding ActiveTab}"
                       ItemContainerStyle="{StaticResource TabItemStyle}"
                       Background="Transparent">
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Title}" 
                                  MaxWidth="200" 
                                  TextTrimming="CharacterEllipsis"
                                  ToolTip="{Binding Url}"/>
                    </DataTemplate>
                </TabControl.ItemTemplate>
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <views:TabView />
                    </DataTemplate>
                </TabControl.ContentTemplate>
            </TabControl>
        </Border>
        
        <!-- Main Content Area -->
        <ContentControl Grid.Row="2" Content="{Binding ActiveTab}"/>
        
        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#FFF0F0F0" BorderBrush="#FFACACAC" BorderThickness="0,1,0,0" Height="28">
            <DockPanel Margin="8,0">
                
                <!-- Status Messages -->
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <Border Background="#FF4CAF50" CornerRadius="8" Padding="8,2" Margin="0,0,8,0"
                            Visibility="{Binding HasSanitizedUrl, Converter={StaticResource BoolToVisibility}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="✓ Sanitized" Foreground="White" FontSize="11"/>
                            <Button Content="Undo" FontSize="10" Background="Transparent" Foreground="White" 
                                   BorderThickness="0" Margin="6,0,0,0" Cursor="Hand"/>
                        </StackPanel>
                    </Border>
                    
                    <Border Background="#FF2196F3" CornerRadius="8" Padding="8,2" Margin="0,0,8,0">
                        <TextBlock Text="🛡️ Protected" Foreground="White" FontSize="11"/>
                    </Border>
                </StackPanel>
                
                <!-- Performance Info -->
                <TextBlock DockPanel.Dock="Right" 
                          Text="{Binding PerformanceInfo}" 
                          FontSize="11" 
                          Foreground="#FF666666" 
                          VerticalAlignment="Center"/>
                
                <!-- Main Status -->
                <TextBlock Text="{Binding StatusMessage}" 
                          FontSize="12" 
                          VerticalAlignment="Center" 
                          Margin="8,0"
                          TextTrimming="CharacterEllipsis"/>
            </DockPanel>
        </Border>
    </Grid>
</Window>